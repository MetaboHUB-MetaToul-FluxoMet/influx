=======================
Change Log for influx_s
=======================

2014-06-11 version 2.11
-----------------------
New features:
 - a joint use of the options ``--fseries`` and ``--irand`` gives a possibility to mix fixed and random values in starting points
 - post treatment option ``posttreat_R`` is introduced in FTBL file. A user script written in R can be used to chain flux estimation and customized data treatment, e.g. graph plotting in a pdf file or simply saving of all the environment for later use and exploring in an R interactive session
 - added optional ``INEQUALITIES/METAB`` section in FTBL file. It can be helpful to limit variations of estimated metabolite concentrations (suggested by Marc Carnicer, INSA of Toulouse, France)
 - added optional ``EQUALITIES/METAB`` section in FTBL file. It can be helpful to fix a ratio between varying metabolite concentrations (suggested by Marc Carnicer, idem)
 - the default value of ``btdesc`` parameter in NLSIC algorithm is lowered from 0.75 to 0.1. In some cases, it can accelerate the optimization convergence.
Bug fixes:
 - fixed EMU list of participants in measurements
 - fixed measurement matrix when only one measurement is available
 - fixed a fatal error when no free flux is available but at least one metabolite quantity must be estimated
 - fixed a bug in pooled measurements. This bug was harmful only if the metabolite pooling was used in more than one type of measurements, e.g. mass *and* labeling. If only one type of measurements used pooling (e.g. mass), the bug was without effect
 - where appropriate, a word "labeling" was replaced by "label" in the field names of the ``_res.kvh`` file
 - fixed superfluous backtracking iterations present for some particular residual functions
 - if a flux or a metabolite is present more than once in formulas of (IN)EQUALITIES sections, its coefficients are summed up instead of taking only the last one
 - fixed a fatal error in generating inequality matrix for net fluxes

2014-04-08 version 2.10
-----------------------
New features:
 - added an option ``--tikhreg`` which is an alternative for ``--ln`` option. In case of rank deficient Jacobian, it calculates an increment step of the smallest norm in  *approximative* way. It is done by Tikhonov regularization
 - added an option ``--ffguess`` which makes to ignore the partition between free and dependent fluxes defined in FTBL file(s) and automatically guess a new free/dependent flux partition (suggested by Roland Nilsson, Karolinska Institutet, Sweden)
 - added utility ``ftbl2kvh.py`` which is useful for debugging purposes only
 - utilities ``ftbl2xgmml.py``, ``ftbl2cumoAb.py``, ``ftbl2netan.py`` and ``ftbl2kvh.py`` are rewritten in such a way that if no output redirection (with operands '>' or '|') occurs on the command line, the name of the output file is automatically derived from the input one. The suffix ``.ftbl`` is simply replaced with ``.xgmml``, ``.sys``, ``.netan`` or ``.kvh`` respectively. Thus a plain drug-and-drop can work with these utilities
 - option ``--TIMEIT`` reports times with subsecond precision. The actual precision depends on the platform but typically a 0.01 s precision should be available. On Windows, the precision is usually 1/60 of a second
 
Bug fixes:
 - fixed ``include_growth_flux`` option for ``ftbl2cumoAb.py`` utility (reported by Marc Carnicer, INSA of Toulouse, France)
 - fixed a bug preventing from checking for a linear dependence between rows of stoechiometric matrix if no constrained net flux is defined in the FTBL file (reported by Roland Nilsson, idem)

2014-02-05 version 2.9
----------------------
New features:
 - utility ``ftbl2xgmml.py`` replaces ``ftbl2rsif.py``. Now, a standalone XGMML file describes both a network and its graphical properties instead of a collection of files where this information was spread. New graphical conventions are now used.
 - an obsolete utility ``ftbl2cytoscape.bat`` is removed form the distribution.
 - added utility ``res2ftbl_meas.py`` generating measurement section from a result file _res.kvh
 - added utility ``expa2ftbl.R`` transforming stoechiometric information in EXPA format (http://gcrg.ucsd.edu/Downloads/ExtremePathwayAnalysis) to various sections of FTBL file, namely to ``EQUALITY`` section where non carbon carrying fluxes can appear
 - files generated by ``influx_s`` and collecting values for graphical representation (like ``edge.netflux.mynetwork`` and others) are renamed by adding a suffix ``.attrs`` to make them compatible with Cytoscape v3.0
 - utilities ``ffres2ftbl.sh`` and ``ff2ftbl.py`` distributed for a long time ago, are now mentioned in the documentation

Bug fixes:
 - fixed ``--fullsys`` option broken in the previous release.

2014-01-27 version 2.8
----------------------
New features:
 - ``EQUALITY`` section in FTBL file may include fluxes absent in ``NETWORK`` section, e.g. fluxes involved in non carbon carrying reactions (suggested by Roland Nilsson, Karolinska Institutet, Sweden)
 - when a meaningful partition between free and dependent fluxes cannot be made, a proposition is made as to stoechiometric equations to be eliminated by hand (suggested by Roland Nilsson, idem) 
 - when ``--clownr`` option is used, reduced size of cumomer system is more efficient than without this option (replace a fix in 2.6 version)

Bug fixes:
 - fixed useless memory consumption during ftbl parsing when ``--emu`` option is used and very long molecules (say >20 carbons) are present (reported by Roland Nilsson, idem)
 - some error messages are made more explicit during FTBL parsing
 - fixed Jacobian calculation for condensing input reaction
 - fixed matrix constructions when no free flux is defined
 - fixed b term for full cumomer system
 - fixed inequality enforcement when adaptive backtracking is used in NLSIC
 - fixed inequality precedence, now specific inequalities from FTBL file prevail on ``--cupn=CUPN`` option 

2013-10-22 version 2.7
----------------------
New features:
 - Monte-Carlo simulations are done in parallel on Windows platform too (needs R package ``snow``)
 - if the option ``--seed=SEED`` is used, Monte-Carlo simulations are now reproducible even if run in parallel on multiple cores
 - for rank deficient Jacobian, the inequalities are now better enforced
 - starting value for ``maxstep`` parameter is set to :math:`10||p||` instead of :math:`||p||` where *p* is a vector of starting values for free parameters to fit.
Bug fixes:
 - fixed a bug preventing to report partial Monte-Carlo results if some simulations failed and some not
 - fixed a bug making to use all available cores instead of only one when ``NP`` was set to 1
 - fixed a fatal error when inequality enforcement fails
 - error and log messages during zero cross passes are made more explicit
 - fixed sending some error messages on standard output instead of ``.err`` file
 - when cumomer matrix is singular, fixed an error message about zero fluxes

2013-10-02 version 2.6
----------------------
New features:
 - added option ``--sln`` (solution least norm) which applies 'least norm' to the whole solution vector of free parameters, not just to the increment vector (like ``--ln`` does)
 - a parallel calculation of multiple FTBLs is moved from python to R code. In such a way, some economies of repeated R starting up and library loading are made
 - when zero crossing is used (``--zc=ZC``) a third pass is added without any zc constraint.
 - added an option ``maxstep`` to control list of nlsic(). In some situations, it can make the convergence more stable at early iterations.

Bug fixes:
 - fixed a fatal error preventing from using BFGS optimization method
 - fixed an error in calculating reduced size of cumomer or EMU systems. It did not impact the results (at least for well defined network) but made calculations a little bit longer (reported by Stephane Mottelet, University of Compiegne, France).
 - a more explicit error message is generated when a given choice of free fluxes leads to a square but singular flux (stoechiometric) matrix.
 - some error messages were printed on standard output instead of ``.err`` file.

2013-06-28 version 2.5
----------------------
New features:
 - an argument of the option ``--np=NP`` (number of processes) can be fractional, between 0 and 1 in which case the number of requested cores is calculated as NP*number_of_available_cores
 - in documentation, added a section describing some problematic cases and measures which could be undertaken to solve or to work around them. Few more field names in the output file are described (based on discussions with Yanfen Fu, University of Washington)
 - missing values in measurements (NA as Non Available) are allowed in FTBL files.

Bug fixes:
 - fixed a fatal error if the rights of generated R file cannot be changed
 - fixed a bug for ``--ln`` (least norm) option when without inequalities, increments were not of least norm (reported by Stephane Massou, INSA of Toulouse, France)
 - fixed an algorithm used in ``--ln``. Now for all inequality systems, both least residual norm and least solution norm are achieved (before, for some systems it was not the case). **Due to this fix, we highly recommend to update to this version if you use** ``--ln`` **option**
 - fixed a bug in "zero crossing" inequalities. Now, inequalities involving only constrained fluxes are canceled.

2013-04-11 version 2.4
----------------------
New features:
 - number of parallel processes (in case of multiple FTBL files) is limited to a number of cores or to an argument of the ``--np`` option
 - some consistency controls were added on flux names in various FTBL sections.

Bug fixes:
 - fixed a bug in formatting some error messages during FTBL parsing;
 - fixed an accidental removing of kvh.py file from the previous release;
 - fixed non signaling to check ``.err`` file while some parsing errors did produce;

2013-03-28 version 2.3
----------------------
New features:
 - external ``multicore`` R package is replaced by native ``parallel`` package;
 - convergence information of Monte-Carlo simulations is reported in the result file;
 - relative SD (rsd) in Monte-Carlo statistics is calculated as SD/abs(mean) and no more as SD/abs(estimated parameter);
 - if the number of really calculated samples in Monte-Carlo is less than 2, statistics are not calculated;
 - R code is self sufficient to be executed via source() function, even in parallel way;
 - with a new option ``--nocalc``, R code is generated but not executed.

Bug fixes:
 - fixed concurrent access to a global variable in Monte-Carlo parallel execution;
 - fixed scope issue in Monte-Carlo simulations preventing from update of the current solution;
 - fixed some redundant warning messages;
 - fixed placement of .err and .log files if FTBL(s) is (are) given with subdirectories in their names.

2013-03-15 version 2.2.1
------------------------
Bug fixes:
 - fixed a fatal error in Jacobian matrix construction when no measured fluxes are provided in FTBL file (reported by Yanfen Fu, University of Washington);
 - in the User's manual, added a naming convention for variable growth fluxes.

2013-03-13 version 2.2
----------------------
New features:
 - if more than one FTBL file is given in argument to ``influx_s``, all files are proceeded simultaneously in independent processes;
 - outliers in measurements can be automatically detected and excluded from parameter fitting.

Bug fixes:
 - fixed an error preventing Monte-Carlo results to be written if ``multicore`` package is not installed;
 - fixed a documentation error about :math:`\ln(M)` in ``mynetwork.pres.csv`` file;
 - fixed warning resuming if there are many of them;
 - fixed some error message generation on FTBL parsing.

2013-02-15 version 2.1
----------------------
New features:
 - in nlsic() a new field 'retres' is added to the list of returned values. It transfers "as is" the list returned by a last call to residual calculation function;
 - added a writing of generalized inverse of Jacobian to the result file;

Bug fix:
 - fixed a typo preventing Monte-Carlo statistics on forward-reverse fluxes to be written in the result file.

2013-02-05 version 2.0
----------------------

New features:
 - metabolite pooling is modeled. Such pooling can appear due to compartmentation phenomenon or due to isomer coelution in chromatography. Starting from this version, metabolite concentrations can be part of fitted parameters;
 - adaptive backtracking algorithm is introduced to NLSIC algorithm;
 - history of convergence during minimization can be retrieved;
 - symbolic equations for dependent fluxes expressed as functions of free and constrained fluxes are generated by ftbl2cumoAb.py script;
 - METAB_MEASUREMENTS section is added to FTBL format;
 - added :math:`\chi^2` test for evaluating the goodness of fit;
 - removed ``metab_scale`` field from OPTIONS section in FTBL format;
 - "dead end" internal metabolites are allowed in a network without being an output metabolite. As consequence, input-output fluxes must be explicitly declared as non reversible in the FTBL;
 - added optional EMU framework (``--emu``);
 - added optional series of starting points, fixed or randomly generated
   (``--fseries``, ``--iseries``);
 - matrix construction is reworked and fortran code is removed. Now, no more ``Rtool`` installation is required for running ``influx_s``;
 - some error messages are made more explicit and more precise;
 - outdated R package ``fUtilities`` is no more required;

Bug fixes:
 - fixed stoechiometric matrix construction when for a given metabolite;
   all fluxes are free or constrained;
 - fixed candidate propositions for free fluxes;
 - fixed standard deviation value for a ``DD/T`` field in ``PEAK_MEASUREMENTS`` section.

2011-10-11 version 1.0
----------------------

Initial release. Main features:
 - NLSIC algorithm;
 - FTBL input format from 13CFlux project;
 - reduced cumomer set for cumomer balance equations;
 - sparse matrices;
 - usage of ``multicore`` R package for Monte-Carlo simulations on Unix platform;
 - usable on platforms having Python+numpy and R+some modules;
 - command line interface;
 - brief user's and programmer's documentation;
 - OpenSource (ECL) license.
